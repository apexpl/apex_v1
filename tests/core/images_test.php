<?php
declare(strict_types = 1);

namespace tests\core;

use apex\app;
use apex\svc\db;
use apex\svc\debug;
use apex\app\utils\images;
use apex\app\tests\test;

/**
 * Handles all unit test for the images library, which is 
* located at /src/app/utils/images.php.
 */
class test_images extends test
{

/**
 * setUp
 */
public function setUp():void
{

    // Get app
    if (!$app = app::get_instance()) { 
        $app = new app('test');
    }

}

/**
 * tearDown
 */
public function tearDown():void
{

}

/**
 * Add image
 */
public function test_add()
{

    // Initialize
    $contents = base64_decode('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');
    $client = new images();
    db::query("DELETE FROM images WHERE type = 'unit_test'");

    // Add image
    $image_id = $client->add('screen.png', $contents, 'unit_test', 'apex', 'full', 1);

    // Check database row
    $row = db::get_idrow('images', $image_id);
    $this->assertNotFalse($row);
    $this->assertEquals('screen.png', $row['filename']);
    $this->assertEquals('unit_test', $row['type']);
    $this->assertEquals(300, (int) $row['width']);
    $this->assertEquals(225, (int) $row['height']);

}

/**
 * Upload
 */
public function test_upload()
{

    // Save file
    $tmp_file = sys_get_temp_dir() . '/' . uniqid();
    file_put_contents($tmp_file, base64_decode('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'));

    // Initialize
    $client = new images();
    app::add_file('logo', 'logo.png', $tmp_file);

    // Get false
    $this->assertFalse($client->upload('some_junk_alias', 'unit_test', 'some_junk_test'));

    // Upload file
    $image_id = $client->upload('logo', 'unit_test', 'logo');

    // Check database row
    $row = db::get_idrow('images', $image_id);
    $this->assertNotFalse($row);
    $this->assertEquals('logo.png', $row['filename']);
    $this->assertEquals('unit_test', $row['type']);
    $this->assertEquals(182, (int) $row['width']);
    $this->assertEquals(39, (int) $row['height']);

}

/**
 * Get image
 */
public function test_get()
{

    // Initialize
    $client = new images();
    app::update_config_var('core:cache', 1);

    // Get false
    $this->assertFalse($client->get('ungsagsdest', 'some_junk_alias'));

    // Get default
    list($filename, $type, $width, $height, $contents) = $client->get('unit_test', 'some_junk_alias', 'full', true);
    $this->assertEquals('screen.png', $filename);
    $this->assertEquals(300, (int) $width);
    $this->assertEquals(225, (int) $height);

    // Get other image
    list($filename, $type, $width, $height, $contents) = $client->get('unit_test', 'logo');
    $this->assertEquals('logo.png', $filename);

    // Get from cache now
    list($filename, $type, $width, $height, $contents) = $client->get('unit_test', 'logo');
    $this->assertEquals('logo.png', $filename);

}

/**
 * Display
 */
public function test_display()
{

    // Not found
    $html = $this->http_request('image/some_junk_alias-that_will_never_exist/test');
    $this->assertStringContains($html, 'No image exists');

    // Get image
    $html = $this->http_request('image/unit_test/logo/full');
    $this->assertTrue(true);

}

/**
 * Add thumbnail
 */
public function test_add_thumbnail()
{

    // Get image
    $client = new images();
    list($filename, $type, $width, $height, $contents) = $client->get('unit_test', 'screen', 'full', true);
    $this->assertEquals('screen.png', $filename);

    // Add thumbnail
    $image_id = $client->add_thumbnail('unit_test', 'screen', 'thumb', 50, 50);

    $this->assertNotFalse($image_id);

    // Check row
    $row = db::get_idrow('images', $image_id);
    $this->assertNotFalse($row);
    $this->assertEquals('thumb', $row['size']);
    $this->assertEquals(50, (int) $row['width']);
    $this->assertEquals(50, (int) $row['height']);

}


}


